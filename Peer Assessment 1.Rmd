---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
keep_md: true
---

##Loading and preprocessing the data

```{r}
cls = c("integer", "character", "integer")
data <- data <- read.csv("activity.csv", header = TRUE, colClasses = cls, na.strings = "NA")
data$date <- as.Date(data$date)
data1 <- subset(data, !is.na(data$steps))
```

##What is the mean total of steps taken per day?

The histogram generated by the code below represents the distribution of total daily steps
```{r}
SumByDay <- tapply(data1$steps, data1$date, sum, na.rm=TRUE, simplify=T)


hist(x=SumByDay,
     col="blue",
     breaks=30,
     xlab="Daily total steps",
     ylab="Frequency",
     main="The distribution of daily total steps")
```

Next, the mean and median are calculated
```{r}
mean(SumByDay)
median(SumByDay)
```

##What is the average daily activity pattern?

This block of code examines the average number of steps taken, averaged across all days, represented as a time series plot.
```{r}
 AvgSteps <- tapply(data1$steps, data1$interval, mean, na.rm = TRUE, simplify = T)
AvgSteps1 <- data.frame(interval = as.integer(names(AvgSteps)), avg=AvgSteps)

with(AvgSteps1,
     plot(interval,
          avg,
          type = "l",
          xlab = "5 minute intervals",
          ylab = "Average steps in the interval across all days"))
```

The next step is to determine which 5 minute interval, across all days, contains the maximum step count
```{r}
MaxSteps <- max(data1$avg)
AvgSteps1[AvgSteps1$avg == MaxSteps,]
```

##Imputing missing values

First, the total number of missing values in the orginal dataset will be calculated.
```{r}
sum(is.na(data$steps))
```

The orginal dataset features 2304 observations with missing data.

I will use a simple imputation stratedy to replace these missing values - substitute the mean in for missing data. A new dataset, with an equal number of observations as the original dataset, will be created.
```{r}
dfImpute <- data
ndx <- is.na(dfImpute$steps)
int_avg <- tapply(data1$steps, data1$interval, mean, na.rm=TRUE, simplify=T)
dfImpute$steps[ndx] <- int_avg[as.character(dfImpute$interval[ndx])]
```

Now a histogram of the new dataset will be created.
```{r}
new_dailysum <- tapply(dfImpute$steps, dfImpute$date, sum, na.rm=TRUE, simplify=T)

hist(x=new_dailysum,
     col="blue",
     breaks=30,
     xlab="daily steps",
     ylab="frequency",
     main="The distribution of daily total steps (with missing data imputed)")

mean(new_dailysum)
median(new_dailysum)
```

The mean of the imputed dataset has not changed, however the median has been altered slightly.  The median is now equal to the mean.  The impact of imputing the missing data through this method increases the centricity of the distribution.

##Are there differences in activity patterns between weekdays and weekends?

First we create a new variable "wk" in the dataset with two levels: "weekday" and "weekend"
```{r}
is_weekday <- function(d) {
    wd <- weekdays(d)
    ifelse (wd == "Saturday" | wd == "Sunday", "weekend", "weekday")
}

wx <- sapply(dfImpute$date, is_weekday)
dfImpute$wk <- as.factor(wx)
head(dfImpute)
```

Now we make a panel plot containing a time series plot of the 5-minute interval and the average number of steps taken, averaged across all weekday days or weekend days (y-axis).
```{r}
wk_df <- aggregate(steps ~ wk+interval, data=dfImpute, FUN=mean)

library(lattice)
xyplot(steps ~ interval | factor(wk),
       layout = c(1, 2),
       xlab="Interval",
       ylab="Number of steps",
       type="l",
       lty=1,
       data=wk_df)
```

From the panel plot it looks like the weekday activities arise earlier than the weekends - weekday activities arise around 5~6am and weekend activities arise around 8am. We can also observe that from 10am to 5pm, the weekends have higher activity levels than the weekdays.